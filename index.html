<!DOCTYPE html>
<html lang = "en-us">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Esri Leaflet</title>

  <!-- Load Leaflet from CDN -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
    crossorigin=""></script>

  <!-- Load Esri Leaflet from CDN -->
  <script src="https://unpkg.com/esri-leaflet@3.0.0/dist/esri-leaflet.js"></script>
  <script src="https://unpkg.com/esri-leaflet-vector@3.0.0/dist/esri-leaflet-vector.js"></script>

  <style>
    body { margin:0; padding:0; }
    #map {
        position: absolute;
        top:0;
        bottom:0;
        right:0;
        left:0;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 14px;
        color: #323232;
      }
  </style>

</head>

<body>
  <div id="map"></div>
  <script>

    const apiKey = "AAPK947bf115dd8d44da9b119d18ed465670bSQfPQOvMqOLYYWGprUm0df469-0wWWO27mnQPE11xqj1T5YtjdKxaYJkxN2hJST";
    const map = L.map('map', {
      minZoom: 2
    }).setView([-65,-60], 5);

    // define basemap
    const basemapLayers = {
      "Topographic": L.esri.Vector.vectorBasemapLayer('ArcGIS:Topographic', {apiKey: apiKey}).addTo(map),
      "Light Gray": L.esri.Vector.vectorBasemapLayer('ArcGIS:LightGray', {apiKey: apiKey}).addTo(map),
      "Dark gray": L.esri.Vector.vectorBasemapLayer('ArcGIS:DarkGray', {apiKey: apiKey}).addTo(map),
      "ChartedTerritory": L.esri.Vector.vectorBasemapLayer('ArcGIS:ChartedTerritory', {apiKey: apiKey}).addTo(map),
      "OSM": L.esri.Vector.vectorBasemapLayer('OSM:Standard', {apiKey: apiKey}).addTo(map),
      "Imagery": L.esri.Vector.vectorBasemapLayer('ArcGIS:Imagery', {apiKey: apiKey}).addTo(map)
    }

    // Add basemap layer
    L.control.layers(basemapLayers).addTo(map);

    // Create the select dropdown and add to the top-right of the map
    L.Control.QueryControl = L.Control.extend({
      onAdd: function(map) {
        // Array of query where clauses
        const whereClauses = ["Choose a WHERE clause...",
        "Group = 'Algae'","Group = 'Angiosperm'","Group = 'Arthropod'","Group = 'Bryophyte'","Group = 'Fungi'","Group = 'Lichen'","Group = 'Rotifer'","Group = 'Tardigrade'","Group = 'Other animals'",
        "Taxa = 'algae'","Taxa = 'fungi'","Taxa = 'lichen'","Taxa = 'moss'","Taxa = 'grass'","Taxa = 'pearlwort'","Taxa = 'plant'","Taxa = 'tardigrade'","Taxa = 'mite'","Taxa = 'springtail'", "Taxa = 'insect'","Taxa = 'nematode'", "Taxa = 'nemertea'", "Taxa = 'rotifer'"
        ];
        // Create select
        const select = L.DomUtil.create("select","");
        select.setAttribute("id", "whereClauseSelect");
        select.setAttribute("style", "font-size: 16px;padding:4px 8px;");
        whereClauses.forEach(function(whereClause){
          let option = L.DomUtil.create("option");
          option.innerHTML = whereClause;
          select.appendChild(option);
        });
        return select;
      },

      onRemove: function(map) {
        // Nothing to do here
      }
    });

    L.control.queryControl = function(opts) {
      return new L.Control.QueryControl(opts);
    }

    L.control.queryControl({
      position: 'topright'
    }).addTo(map);

    // Add the Feature Layer to the map
    const parcels = L.esri.featureLayer({
      url: "https://services1.arcgis.com/NIkwK16KnqB4PR1J/arcgis/rest/services/antarctic_t_genetic/FeatureServer/0",
      simplifyFactor: 0.5,
      precision: 4,
      where: '1 = 0',
      style: function(feature) {
        // https://leafletjs.com/reference-1.7.1.html#path-option
        return {
          opacity: 1.0,
          weight: 0.5,
          color: 'white',
          fillColor: '#19A1E6',
          fillOpacity: 0.5
         };
      }
    }).addTo(map);

    // When the selected where clause changes, set the filter on the layer
    const select = document.getElementById('whereClauseSelect');
    select.addEventListener('change', () => {
      if(select.value !== '') {
        parcels.setWhere(select.value);
      }
    });
  </script>
</body>

</html>
